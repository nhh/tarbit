#!/usr/bin/env ruby

require 'commander/import'
require 'tarbit'

# :name is optional, otherwise uses the basename of this executable
program :name, 'Tarbit - SSH Tarpit using Ruby'
program :version, Tarbit::VERSION
program :description, 'Stupid command that prints foo or bar.'

command :serve do |c|
  c.syntax = 'apollo serve [options]'
  c.description = 'Runs the apollo server'
  c.option '--debug', nil, 'Runs the apollo server in debug mode'
  c.option '--suffix STRING', String, 'Adds a suffix to bar'
  c.action do |args, options|
    puts "Starting tarbit ssh tarpit"

    server = Tarbit::Server.new
    statistic = Tarbit::Statistic.new(server, 10)

    Async do |task|
        statistic.watch
        server.run
    end

  end
end